@reference "./tailwind.css";

@layer components {
  .am-surface-card {
    @apply bg-card-surface border border-card-border rounded-card shadow-card;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  .am-topbar {
    @apply flex items-center justify-between gap-am-12;
  }

  .am-section {
    @apply flex flex-col gap-am-12;
  }

  .am-section-header {
    @apply flex items-start justify-between gap-am-12;
  }

  .am-section-headerCopy {
    @apply min-w-0;
  }

  .am-section-headerSubtitle {
    @apply mt-am-4;
  }

  .am-section-headerAction {
    @apply shrink-0;
  }

  .am-page-headerRow {
    @apply flex items-start justify-between gap-3;
  }

  .am-page-headerCopy {
    @apply min-w-0;
  }

  .am-page-headerSubtitle {
    @apply mt-0.5;
  }

  .am-page-headerAction {
    @apply shrink-0;
  }

  .am-list-row {
    @apply w-full p-[14px] flex items-center gap-3 text-left cursor-default;
  }

  button.am-list-row {
    @apply cursor-pointer border-0;
    font: inherit;
    color: inherit;
  }

  .am-list-rowBefore {
    @apply shrink-0;
  }

  .am-list-rowCopy {
    @apply flex-1 min-w-0 flex flex-col gap-0.5;
  }

  .am-list-rowValue {
    @apply shrink-0;
  }

  .am-list-rowChevron {
    @apply shrink-0 opacity-72;
  }

  .am-catalog-list {
    @apply flex flex-col;
  }

  /* Responsive grid: 1 col → 2 col (640px) → 3 col (1200px). */
  .am-catalog-grid {
    @apply grid grid-cols-1 gap-3.5;
  }

  .am-deal-grid {
    @apply grid grid-cols-1 gap-3.5;
  }

  .am-escrow-heading {
    @apply flex flex-col;
  }

  .am-finance-stack {
    @apply relative z-1 flex flex-col gap-3.5;
  }

  .am-finance-card {
    @apply bg-card-surface border border-card-border rounded-card shadow-card;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .am-wallet-top {
    @apply flex items-center justify-between gap-2.5;
  }

  .am-wallet-actions {
    @apply grid grid-cols-4 gap-2;
  }

  .am-wallet-headerAmount {
    @apply tabular-nums;
  }

  .am-wallet-heroCard {
    background: var(--am-wallet-hero-surface);
  }

  .am-wallet-segment-active {
    background: var(--am-wallet-segment-active-bg);
    @apply rounded-[18px];
  }

  .am-wallet-muted {
    color: var(--am-finance-muted);
  }

  .lucide {
    @apply block align-middle shrink-0;
  }

  .flex-center {
    @apply flex items-center justify-center;
  }

  /* Shared components — Phase 3 migration from inline styles. */

  /* Chip — pill and rounded variants. */
  .am-chip {
    @apply px-[14px] py-[6px] rounded-chip border border-separator;
    @apply bg-bg-base text-fg-secondary text-[13px] font-medium;
    @apply whitespace-nowrap cursor-pointer shrink-0 leading-tight;
    -webkit-tap-highlight-color: transparent;
  }

  .am-chip[data-active="true"] {
    @apply bg-accent text-white border-transparent;
  }

  .am-chip--rounded {
    @apply rounded-[16px];
  }

  /* SearchInput */
  .am-search-input {
    @apply flex items-center gap-am-8 rounded-[12px] bg-bg-base;
    @apply border-[1.5px] border-separator;
    @apply px-3 py-2.5;
    transition: border-color 0.2s ease;
  }

  .am-search-input[data-focused="true"] {
    border-color: var(--color-accent-primary);
  }

  .am-search-input__icon {
    @apply w-[18px] h-[18px] shrink-0 text-fg-tertiary;
    transition: color 0.2s ease;
  }

  .am-search-input[data-focused="true"] .am-search-input__icon {
    color: var(--color-accent-primary);
  }

  .am-search-input__field {
    @apply flex-1 border-0 outline-0 bg-transparent text-[15px] text-fg-primary leading-[1.3];
    font-family: inherit;
  }

  /* FixedBottomBar */
  .am-fixed-bottom-bar {
    @apply fixed left-0 right-0 bottom-0 z-20;
    @apply bg-bg-base;
    padding: 12px 16px calc(16px + var(--am-safe-area-bottom));
    border-top: 0.5px solid var(--color-border-separator);
  }

  /* EmptyState */
  .am-empty-state {
    @apply flex flex-col items-center justify-center text-center;
    @apply py-12 px-6 gap-3;
  }

  .am-empty-state__icon {
    @apply w-16 h-16 rounded-[20px] bg-bg-base border border-separator;
    @apply flex items-center justify-center;
  }

  .am-empty-state__action {
    @apply mt-3;
  }

  /* SegmentControl */
  .am-segment {
    @apply flex relative rounded-[10px] p-0.5;
    @apply bg-bg-base border border-separator;
  }

  .am-segment__tab {
    @apply flex-1 relative z-1 py-2 px-4 rounded-[8px];
    @apply border-0 cursor-pointer bg-transparent;
    @apply text-[14px] font-medium text-fg-secondary;
    font-family: inherit;
    -webkit-tap-highlight-color: transparent;
    transition: color 0.2s ease;
  }

  .am-segment__tab[data-active="true"] {
    @apply text-white;
  }

  .am-segment__pill {
    @apply absolute inset-0 rounded-[8px] bg-accent;
    z-index: -1;
  }

  /* FilterButton */
  .am-filter-btn {
    @apply relative w-[42px] h-[42px] rounded-[12px];
    @apply border border-separator bg-bg-base;
    @apply flex items-center justify-center;
    @apply cursor-pointer p-0;
  }

  .am-filter-btn[data-active="true"] {
    @apply bg-accent border-transparent;
  }

  .am-filter-btn__icon {
    @apply w-5 h-5 text-fg-secondary;
  }

  .am-filter-btn[data-active="true"] .am-filter-btn__icon {
    @apply text-white;
  }

  .am-filter-btn__badge {
    @apply absolute -top-1 -right-1 w-[18px] h-[18px] rounded-full;
    @apply bg-destructive text-white text-[11px] font-bold;
    @apply flex items-center justify-center;
    border: 2px solid var(--color-background-base);
  }

  /* ChannelAvatar */
  .am-avatar {
    @apply rounded-full flex items-center justify-center;
  }

  .am-avatar__letter {
    @apply text-white font-semibold leading-none;
  }

  .am-avatar__badge {
    @apply absolute -bottom-0.5 -right-0.5 flex items-center justify-center;
  }

  .am-avatar__wrapper {
    @apply relative shrink-0;
  }

  button.am-avatar__wrapper {
    @apply cursor-pointer bg-transparent border-0 p-0;
  }

  /* Bottom tab item */
  .am-tab-item {
    @apply flex flex-col items-center justify-center gap-[3px] flex-1 h-full;
    @apply no-underline rounded-[22px];
    @apply border border-transparent;
    transition: color 0.16s ease, background 0.16s ease, transform 0.16s ease, border-color 0.16s ease;
    color: var(--color-foreground-secondary);
    background: transparent;
    transform: translateY(0);
  }

  .am-tab-item[data-active="true"] {
    color: var(--am-tabbar-active-color);
    background: var(--am-tabbar-active-bg);
    border-color: color-mix(in srgb, var(--am-tabbar-active-color) 35%, transparent);
    transform: translateY(-1px);
  }

  /* Hero chip (DealHeroSection) */
  .am-hero-chip {
    @apply inline-flex items-center gap-1;
    @apply px-2.5 py-1 rounded-[8px];
    @apply bg-bg-secondary border border-separator;
    @apply text-[13px] font-medium text-fg-primary tabular-nums;
  }

  /* Icon circle (reusable: 32/36/56px variants) */
  .am-icon-circle {
    @apply rounded-full flex items-center justify-center;
  }

  .am-icon-circle--sm {
    @apply w-8 h-8;
  }

  .am-icon-circle--md {
    @apply w-9 h-9;
  }

  .am-icon-circle--lg {
    @apply w-14 h-14;
  }

  /* Truncated text */
  .am-truncate {
    @apply overflow-hidden whitespace-nowrap block;
    text-overflow: ellipsis;
  }

  /* Tabular numbers */
  .am-tabnum {
    font-variant-numeric: tabular-nums;
  }

  /* Monospace (blockchain addresses, hashes) */
  .am-mono {
    font-family: monospace;
  }

  /* Profile hero card */
  .am-profile-avatar-ring {
    @apply w-20 h-20 rounded-full flex items-center justify-center;
    border: 3px solid var(--color-accent-primary);
    background: color-mix(in srgb, var(--color-accent-primary) 8%, transparent);
  }

  .am-role-badge {
    @apply inline-flex items-center gap-1 px-2.5 py-1 rounded-chip;
    @apply text-[12px] font-semibold;
    background: color-mix(in srgb, var(--color-accent-primary) 12%, transparent);
    color: var(--color-accent-primary);
  }

  /* Icon button (channel detail, explorer link) */
  .am-icon-button {
    @apply w-9 h-9 rounded-[10px];
    @apply border border-separator bg-bg-base;
    @apply flex items-center justify-center;
    @apply cursor-pointer p-0;
    -webkit-tap-highlight-color: transparent;
  }

  /* Metric row */
  .am-metric-row {
    @apply flex border border-card-border rounded-card bg-card-surface;
  }

  .am-metric-row__cell {
    @apply flex-1 text-center;
    padding: 14px 12px;
  }

  .am-metric-row__divider {
    @apply w-px self-stretch;
    background: var(--am-card-border);
  }

  /* Deal message block */
  .am-deal-message {
    @apply bg-bg-secondary rounded-[10px] px-3.5 py-2.5;
    @apply whitespace-pre-wrap italic text-center;
  }

  /* Status pill */
  .am-status-pill {
    @apply px-3.5 py-2.5 rounded-[10px] flex items-center gap-2;
  }

  /* Topic tag (channel detail) */
  .am-topic-tag {
    @apply px-2 py-1 rounded-[8px] text-[14px] font-medium;
    background: color-mix(in srgb, var(--color-accent-primary) 10%, transparent);
    color: var(--color-accent-primary);
  }

  /* Telegram post preview (isolated chat-only surface) */
  .am-tg-chat-window {
    position: relative;
    overflow: hidden;
    border-radius: 12px;
    min-height: 500px;
    background: var(--am-tg-chat-bg);
    padding: 12px;
  }

  .am-tg-chat-pattern {
    position: absolute;
    inset: 0;
    background-image: var(--am-tg-chat-pattern-url);
    background-size: 400px;
    opacity: 0.35;
    mix-blend-mode: overlay;
    pointer-events: none;
  }

  .am-tg-chat-content {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }

  .am-tg-day-divider {
    align-self: center;
    border-radius: 999px;
    padding: 2px 10px;
    font-size: 11px;
    font-weight: 600;
    color: color-mix(in srgb, var(--color-static-white) 96%, transparent);
    background: color-mix(in srgb, var(--color-static-black) 16%, transparent);
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
  }

  .am-tg-message-stack {
    width: min(100%, 420px);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  .am-tg-message-bubble {
    position: relative;
    width: 100%;
    max-width: 100%;
    background: var(--am-tg-bubble-bg);
    border-radius: 12px 12px 12px 4px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
    overflow: visible;
  }

  .am-tg-bubble-tail {
    position: absolute;
    left: -9px;
    bottom: 0;
    width: 9px;
    height: 20px;
    fill: var(--am-tg-bubble-bg);
  }

  .am-tg-channel-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px 2px;
  }

  .am-tg-channel-avatar {
    width: 24px;
    height: 24px;
    border-radius: 999px;
    object-fit: cover;
    flex-shrink: 0;
  }

  .am-tg-channel-avatar--fallback {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    color: var(--color-static-white);
    background: color-mix(in srgb, var(--tg-theme-link-color, #2481cc) 90%, transparent);
  }

  .am-tg-channel-name {
    min-width: 0;
    display: block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    font-size: 14px;
    font-weight: 700;
    color: var(--tg-theme-link-color, #2481cc);
  }

  .am-tg-media-grid {
    display: grid;
    gap: 2px;
    overflow: hidden;
    border-radius: 8px;
    margin: 2px 8px 0;
    background: color-mix(in srgb, var(--color-static-black) 10%, transparent);
  }

  .am-tg-media--single {
    grid-template-columns: 1fr;
    max-height: 400px;
  }

  .am-tg-media--double {
    grid-template-columns: repeat(2, minmax(0, 1fr));
    aspect-ratio: 4 / 3;
  }

  .am-tg-media--triple {
    grid-template-columns: repeat(2, minmax(0, 1fr));
    grid-template-rows: repeat(2, minmax(0, 1fr));
    aspect-ratio: 4 / 3;
  }

  .am-tg-media--triple > :first-child {
    grid-row: span 2;
  }

  .am-tg-media--quad {
    grid-template-columns: repeat(2, minmax(0, 1fr));
    grid-template-rows: repeat(2, minmax(0, 1fr));
    aspect-ratio: 1 / 1;
  }

  .am-tg-media--mosaic {
    grid-template-columns: repeat(2, minmax(0, 1fr));
    grid-template-rows: repeat(2, minmax(0, 1fr));
    aspect-ratio: 1 / 1;
  }

  .am-tg-media-cell {
    position: relative;
    overflow: hidden;
    background: color-mix(in srgb, var(--color-static-black) 10%, transparent);
  }

  .am-tg-media-image {
    width: 100%;
    height: 100%;
    display: block;
    object-fit: cover;
  }

  .am-tg-media-video-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: color-mix(in srgb, var(--color-static-black) 28%, transparent);
  }

  .am-tg-media-video-play {
    width: 40px;
    height: 40px;
    border-radius: 999px;
    position: relative;
    background: color-mix(in srgb, var(--color-static-black) 50%, transparent);
  }

  .am-tg-media-video-play::before {
    content: '';
    position: absolute;
    left: 16px;
    top: 12px;
    border-top: 8px solid transparent;
    border-bottom: 8px solid transparent;
    border-left: 12px solid color-mix(in srgb, var(--color-static-white) 96%, transparent);
  }

  .am-tg-media-overflow {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    font-weight: 700;
    color: var(--color-static-white);
    background: color-mix(in srgb, var(--color-static-black) 45%, transparent);
  }

  .am-tg-message-body {
    padding: 8px 12px 10px;
  }

  .am-tg-message-body--with-media {
    padding-top: 8px;
  }

  .am-tg-documents {
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding-bottom: 8px;
  }

  .am-tg-document {
    display: flex;
    align-items: center;
    gap: 10px;
    border-radius: 8px;
    padding: 6px;
    background: color-mix(in srgb, var(--color-static-black) 4%, transparent);
  }

  .am-tg-document-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-static-white);
    background: var(--tg-theme-link-color, #2481cc);
    flex-shrink: 0;
  }

  .am-tg-document-info {
    min-width: 0;
    display: flex;
    flex-direction: column;
    line-height: 1.2;
  }

  .am-tg-document-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--color-static-black);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .am-tg-document-size {
    font-size: 12px;
    color: #8e9aa7;
  }

  .am-tg-message-text {
    font-size: 15px;
    line-height: 1.35;
    color: var(--color-static-black);
    white-space: pre-wrap;
    word-break: break-word;
  }

  .am-tg-message-text::after {
    content: '';
    display: table;
    clear: both;
  }

  .am-tg-message-text a {
    color: var(--tg-theme-link-color, #2481cc);
    text-decoration: none;
  }

  .am-tg-message-text a:hover {
    text-decoration: underline;
  }

  .am-tg-message-text code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    font-size: 0.9em;
    padding: 1px 4px;
    border-radius: 4px;
    background: color-mix(in srgb, var(--color-static-black) 8%, transparent);
  }

  .am-tg-message-text pre {
    margin: 6px 0;
    padding: 8px 10px;
    border-radius: 8px;
    overflow-x: auto;
    background: color-mix(in srgb, var(--color-static-black) 8%, transparent);
  }

  .am-tg-message-text [data-spoiler='true'] {
    border-radius: 4px;
    padding: 0 2px;
    color: transparent;
    background: color-mix(in srgb, var(--color-static-black) 90%, transparent);
  }

  .am-tg-message-meta {
    float: right;
    margin: 4px -2px -2px 12px;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 11px;
    color: #9ba7b3;
    user-select: none;
    white-space: nowrap;
  }

  .am-tg-message-edited {
    margin-right: 2px;
  }

  .am-tg-message-views {
    display: inline-flex;
    align-items: center;
    gap: 3px;
  }

  .am-tg-message-eye {
    width: 12px;
    height: 12px;
  }

  .am-tg-inline-keyboard {
    width: 100%;
    margin-top: 4px;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .am-tg-inline-keyboard-row {
    width: 100%;
    display: flex;
    gap: 4px;
  }

  .am-tg-inline-button {
    flex: 1;
    border: none;
    border-radius: 8px;
    padding: 8px 12px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    font-size: 14px;
    font-weight: 500;
    color: var(--tg-theme-link-color, #2481cc);
    background: var(--am-tg-inline-btn-bg);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .am-tg-inline-icon {
    width: 12px;
    height: 12px;
    opacity: 0.72;
  }

  [theme-mode='dark'] .am-tg-message-bubble,
  [data-theme='dark'] .am-tg-message-bubble {
    box-shadow: none;
  }

  [theme-mode='dark'] .am-tg-document-name,
  [data-theme='dark'] .am-tg-document-name {
    color: var(--color-static-white);
  }

  [theme-mode='dark'] .am-tg-message-text,
  [data-theme='dark'] .am-tg-message-text {
    color: color-mix(in srgb, var(--color-static-white) 96%, transparent);
  }

  @media (prefers-color-scheme: dark) {
    :root:not([theme-mode]):not([data-theme]) .am-tg-message-bubble {
      box-shadow: none;
    }

    :root:not([theme-mode]):not([data-theme]) .am-tg-document-name {
      color: var(--color-static-white);
    }

    :root:not([theme-mode]):not([data-theme]) .am-tg-message-text {
      color: color-mix(in srgb, var(--color-static-white) 96%, transparent);
    }
  }
}

/* Responsive grid breakpoints (outside @layer to use media queries). */
@media (min-width: 640px) {
  .am-catalog-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (min-width: 768px) {
  .am-deal-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (min-width: 1200px) {
  .am-catalog-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}
