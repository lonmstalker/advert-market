<?xml version="1.0" encoding="UTF-8"?>
<FindBugsFilter>
    <!-- DI constructors naturally store mutable references -->
    <Match>
        <Bug pattern="EI_EXPOSE_REP2"/>
    </Match>
    <!-- Records expose their components by design -->
    <Match>
        <Bug pattern="EI_EXPOSE_REP"/>
        <Class name="~.*\..*Context$"/>
    </Match>
    <!-- Facade intentionally exposes underlying registry -->
    <Match>
        <Bug pattern="EI_EXPOSE_REP"/>
        <Class name="com.advertmarket.shared.metric.MetricsFacade"/>
        <Method name="registry"/>
    </Match>
    <!-- ConfigurationProperties records expose list components -->
    <Match>
        <Bug pattern="EI_EXPOSE_REP"/>
        <Class name="~.*Properties$"/>
    </Match>
    <!-- DTO/Request/Response records expose components by design -->
    <Match>
        <Bug pattern="EI_EXPOSE_REP"/>
        <Class name="~.*\.api\.dto\..*"/>
    </Match>

    <!-- === FindSecBugs exclusions === -->

    <!-- HTTP_RESPONSE_SPLITTING: headers are sanitized in CorrelationIdFilter -->
    <Match>
        <Bug pattern="HTTP_RESPONSE_SPLITTING"/>
        <Class name="~.*Controller$"/>
    </Match>

    <!-- PREDICTABLE_RANDOM: UUID.randomUUID() is not used for crypto -->
    <Match>
        <Bug pattern="PREDICTABLE_RANDOM"/>
    </Match>

    <!-- SPRING_CSRF_UNRESTRICTED_REQUEST_MAPPING: REST API uses JWT, no CSRF -->
    <Match>
        <Bug pattern="SPRING_CSRF_UNRESTRICTED_REQUEST_MAPPING"/>
    </Match>

    <!-- SPRING_ENDPOINT: REST endpoints are protected by Spring Security -->
    <Match>
        <Bug pattern="SPRING_ENDPOINT"/>
    </Match>

    <!-- MapStruct generated mappers pass nullable record fields to constructors -->
    <Match>
        <Bug pattern="NP_NULL_PARAM_DEREF"/>
        <Class name="~.*MapperImpl$"/>
    </Match>

    <!-- Criteria fields are null-checked before use in search methods -->
    <Match>
        <Bug pattern="NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE"/>
        <Class name="com.advertmarket.marketplace.channel.search.ParadeDbChannelSearch"/>
    </Match>

    <!-- categories() null-check handled via ternary operator -->
    <Match>
        <Bug pattern="NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE"/>
        <Class name="com.advertmarket.marketplace.channel.service.ChannelRegistrationService"/>
        <Method name="register"/>
    </Match>

    <!-- COUNT(*) always returns exactly one row; fetchSingle is safe -->
    <Match>
        <Bug pattern="NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE"/>
        <Class name="com.advertmarket.marketplace.team.repository.JooqTeamMembershipRepository"/>
        <Method name="countManagers"/>
    </Match>
</FindBugsFilter>
