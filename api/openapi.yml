openapi: 3.1.0
info:
  title: Advert Market API
  description: Telegram Mini App marketplace for channel advertising
  version: 0.1.0
servers:
- url: http://localhost:8080
  description: Generated server url
tags:
- name: Channels
  description: Channel catalog and management
- name: Admin
  description: Internal admin endpoints
- name: Pricing Rules
  description: Channel pricing rule management
- name: Channel Team
  description: Channel team management
- name: Auth
  description: Telegram Mini App authentication
- name: Profile
  description: User profile management
paths:
  /internal/v1/canary:
    get:
      tags:
      - Admin
      summary: Get canary status
      operationId: getCanary
      parameters:
      - name: Authorization
        in: header
        required: true
        schema:
          type: string
      responses:
        "200":
          description: Current canary configuration
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/CanaryStatus"
    put:
      tags:
      - Admin
      summary: Update canary settings
      operationId: setCanary
      parameters:
      - name: Authorization
        in: header
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CanaryUpdate"
        required: true
      responses:
        "200":
          description: Updated canary configuration
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/CanaryStatus"
  /api/v1/deals:
    get:
      tags:
      - Deal
      summary: List deals for current user
      operationId: listDeals
      parameters:
      - name: status
        in: query
        required: false
        schema:
          type: string
      - name: cursor
        in: query
        required: false
        schema:
          type: string
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          format: int32
          default: 20
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/CursorPageDealDto"
      security:
      - bearerAuth: []
    post:
      tags:
      - Deal
      summary: Create a new deal
      operationId: createDeal
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDealRequest"
        required: true
      responses:
        "201":
          description: Deal created
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/DealDto"
      security:
      - bearerAuth: []
  /api/v1/deals/{id}:
    get:
      tags:
      - Deal
      summary: Get deal detail
      operationId: getDealDetail
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/DealDetailDto"
        "404":
          description: Deal not found
      security:
      - bearerAuth: []
  /api/v1/deals/{id}/transition:
    post:
      tags:
      - Deal
      summary: Transition deal state
      operationId: transitionDeal
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DealTransitionRequest"
        required: true
      responses:
        "200":
          description: Transition result
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/DealTransitionResponse"
      security:
      - bearerAuth: []
  /api/v1/profile/settings:
    put:
      tags:
      - Profile
      summary: Update user settings
      operationId: updateSettings
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateSettingsRequest"
        required: true
      responses:
        "200":
          description: Settings updated
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/UserProfile"
        "400":
          description: Invalid settings
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/UserProfile"
        "401":
          description: Not authenticated
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/UserProfile"
      security:
      - bearerAuth: []
  /api/v1/profile/onboarding:
    put:
      tags:
      - Profile
      summary: Complete user onboarding
      operationId: completeOnboarding
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OnboardingRequest"
        required: true
      responses:
        "200":
          description: Onboarding completed
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/UserProfile"
        "400":
          description: Invalid interests
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/UserProfile"
        "401":
          description: Not authenticated
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/UserProfile"
      security:
      - bearerAuth: []
  /api/v1/profile/language:
    put:
      tags:
      - Profile
      summary: Update user language
      operationId: updateLanguage
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateLanguageRequest"
        required: true
      responses:
        "200":
          description: Language updated
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/UserProfile"
        "400":
          description: Invalid language code
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/UserProfile"
        "401":
          description: Not authenticated
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/UserProfile"
      security:
      - bearerAuth: []
  /api/v1/channels/{id}:
    get:
      tags:
      - Channels
      summary: Get channel detail
      description: Full channel info including pricing rules
      operationId: getDetail
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "200":
          description: Channel detail
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ChannelDetailResponse"
        "404":
          description: Channel not found
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ChannelDetailResponse"
    put:
      tags:
      - Channels
      summary: Update channel
      description: Update channel details (owner only)
      operationId: update
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChannelUpdateRequest"
        required: true
      responses:
        "200":
          description: Channel updated
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ChannelResponse"
        "403":
          description: Not the owner of the channel
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ChannelResponse"
        "404":
          description: Channel not found
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ChannelResponse"
      security:
      - bearerAuth: []
    delete:
      tags:
      - Channels
      summary: Deactivate channel
      description: Soft-delete a channel (owner only)
      operationId: deactivate
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "204":
          description: Channel deactivated
        "403":
          description: Not the owner of the channel
        "404":
          description: Channel not found
      security:
      - bearerAuth: []
  /api/v1/channels/{channelId}/team/{userId}:
    put:
      tags:
      - Channel Team
      summary: Update member rights
      description: Updates rights for a MANAGER (owner only)
      operationId: updateRights
      parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      - name: userId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TeamUpdateRightsRequest"
        required: true
      responses:
        "200":
          description: Rights updated
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/TeamMemberDto"
        "403":
          description: Not the owner or target is OWNER
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/TeamMemberDto"
        "404":
          description: Team member not found
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/TeamMemberDto"
      security:
      - bearerAuth: []
    delete:
      tags:
      - Channel Team
      summary: Remove team member
      description: Removes a MANAGER (owner or self-removal)
      operationId: remove
      parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      - name: userId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "204":
          description: Member removed
        "403":
          description: Not authorized or target is OWNER
        "404":
          description: Team member not found
      security:
      - bearerAuth: []
  /api/v1/channels/{channelId}/pricing/{ruleId}:
    put:
      tags:
      - Pricing Rules
      summary: Update pricing rule
      description: Updates a pricing rule (owner only)
      operationId: update_1
      parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      - name: ruleId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PricingRuleUpdateRequest"
        required: true
      responses:
        "200":
          description: Rule updated
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/PricingRuleDto"
        "403":
          description: Not the owner of the channel
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/PricingRuleDto"
        "404":
          description: Pricing rule not found
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/PricingRuleDto"
      security:
      - bearerAuth: []
    delete:
      tags:
      - Pricing Rules
      summary: Delete pricing rule
      description: Soft-deletes a pricing rule (owner only)
      operationId: delete
      parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      - name: ruleId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "204":
          description: Rule deleted
        "403":
          description: Not the owner of the channel
        "404":
          description: Pricing rule not found
      security:
      - bearerAuth: []
  /internal/v1/worker-events:
    post:
      tags:
      - worker-callback-controller
      operationId: handleCallback
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WorkerCallback"
        required: true
      responses:
        "202":
          description: Accepted
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/WorkerCallbackResponse"
  /api/v1/channels:
    get:
      tags:
      - Channels
      summary: Search channels
      description: Public channel catalog with filters and BM25 search
      operationId: search
      parameters:
      - name: query
        in: query
        required: false
        schema:
          type: string
      - name: q
        in: query
        required: false
        schema:
          type: string
      - name: category
        in: query
        required: false
        schema:
          type: string
      - name: minSubscribers
        in: query
        required: false
        schema:
          type: integer
          format: int32
      - name: minSubs
        in: query
        required: false
        schema:
          type: integer
          format: int32
      - name: maxSubscribers
        in: query
        required: false
        schema:
          type: integer
          format: int32
      - name: maxSubs
        in: query
        required: false
        schema:
          type: integer
          format: int32
      - name: minPrice
        in: query
        required: false
        schema:
          type: integer
          format: int64
      - name: maxPrice
        in: query
        required: false
        schema:
          type: integer
          format: int64
      - name: minEngagement
        in: query
        required: false
        schema:
          type: number
          format: double
      - name: language
        in: query
        required: false
        schema:
          type: string
      - name: sort
        in: query
        required: false
        schema:
          type: string
          default: SUBSCRIBERS_DESC
      - name: cursor
        in: query
        required: false
        schema:
          type: string
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          format: int32
          default: 20
      responses:
        "200":
          description: Search results
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/CursorPageChannelListItem"
    post:
      tags:
      - Channels
      summary: Register a channel
      description: Registers a previously verified channel
      operationId: register
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChannelRegistrationRequest"
        required: true
      responses:
        "201":
          description: Channel registered
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ChannelResponse"
        "403":
          description: User is not an admin of the channel
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ChannelResponse"
        "409":
          description: Channel already registered
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ChannelResponse"
      security:
      - bearerAuth: []
  /api/v1/channels/my:
    get:
      tags:
      - Channels
      summary: My channels
      description: Returns channels owned by the authenticated user
      operationId: myChannels
      responses:
        "200":
          description: User's channels
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ChannelResponse"
      security:
      - bearerAuth: []
  /api/v1/channels/{channelId}/team:
    get:
      tags:
      - Channel Team
      summary: List team members
      description: Lists all team members (requires manage_team right)
      operationId: list
      parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "200":
          description: List of team members
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TeamMemberDto"
        "403":
          description: Insufficient rights
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TeamMemberDto"
      security:
      - bearerAuth: []
    post:
      tags:
      - Channel Team
      summary: Invite team member
      description: Invites a user as MANAGER (owner only)
      operationId: invite
      parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TeamInviteRequest"
        required: true
      responses:
        "201":
          description: Member invited
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/TeamMemberDto"
        "403":
          description: Not the owner of the channel
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/TeamMemberDto"
        "409":
          description: User is already a team member
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/TeamMemberDto"
        "422":
          description: Manager limit exceeded
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/TeamMemberDto"
      security:
      - bearerAuth: []
  /api/v1/channels/{channelId}/pricing:
    get:
      tags:
      - Pricing Rules
      summary: List pricing rules
      description: Lists active pricing rules for a channel
      operationId: list_1
      parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "200":
          description: List of pricing rules
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PricingRuleDto"
    post:
      tags:
      - Pricing Rules
      summary: Create pricing rule
      description: Creates a pricing rule for a channel (owner only)
      operationId: create
      parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PricingRuleCreateRequest"
        required: true
      responses:
        "201":
          description: Rule created
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/PricingRuleDto"
        "403":
          description: Not the owner of the channel
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/PricingRuleDto"
      security:
      - bearerAuth: []
  /api/v1/channels/verify:
    post:
      tags:
      - Channels
      summary: Verify channel for registration
      description: Checks that the bot is an admin and the user owns the channel
      operationId: verify
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChannelVerifyRequest"
        required: true
      responses:
        "200":
          description: Verification result
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ChannelVerifyResponse"
        "403":
          description: Bot or user lacks required permissions
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ChannelVerifyResponse"
        "404":
          description: Channel not found
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ChannelVerifyResponse"
      security:
      - bearerAuth: []
  /api/v1/bot/webhook:
    post:
      tags:
      - telegram-webhook-controller
      operationId: handleWebhook
      parameters:
      - name: X-Telegram-Bot-Api-Secret-Token
        in: header
        required: false
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              type: string
        required: true
      responses:
        "200":
          description: OK
  /api/v1/auth/logout:
    post:
      tags:
      - Auth
      summary: Logout and revoke current JWT
      description: Blacklists the current JWT token so it can no longer be used
      operationId: logout
      responses:
        "204":
          description: Logged out successfully
        "401":
          description: Not authenticated
      security:
      - bearerAuth: []
  /api/v1/auth/login:
    post:
      tags:
      - Auth
      summary: Login via Telegram initData
      description: Validates Telegram Mini App initData using HMAC-SHA256 and issues
        a JWT token
      operationId: login
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
        required: true
      responses:
        "200":
          description: Authentication successful
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "400":
          description: Invalid request body
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "401":
          description: Invalid or expired initData
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "429":
          description: Too many login attempts
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/LoginResponse"
  /api/v1/profile:
    get:
      tags:
      - Profile
      summary: Get current user profile
      operationId: getProfile
      responses:
        "200":
          description: Profile retrieved
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/UserProfile"
        "401":
          description: Not authenticated
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/UserProfile"
      security:
      - bearerAuth: []
    delete:
      tags:
      - Profile
      summary: Delete user account (soft delete)
      operationId: deleteAccount
      responses:
        "204":
          description: Account deleted
        "401":
          description: Not authenticated
      security:
      - bearerAuth: []
  /api/v1/post-types:
    get:
      tags:
      - Reference Data
      summary: List all post types with labels
      operationId: listPostTypes
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PostTypeDto"
  /api/v1/channels/count:
    get:
      tags:
      - Channels
      summary: Count channels
      description: Returns channel count for given search filters
      operationId: count
      parameters:
      - name: query
        in: query
        required: false
        schema:
          type: string
      - name: q
        in: query
        required: false
        schema:
          type: string
      - name: category
        in: query
        required: false
        schema:
          type: string
      - name: minSubscribers
        in: query
        required: false
        schema:
          type: integer
          format: int32
      - name: minSubs
        in: query
        required: false
        schema:
          type: integer
          format: int32
      - name: maxSubscribers
        in: query
        required: false
        schema:
          type: integer
          format: int32
      - name: maxSubs
        in: query
        required: false
        schema:
          type: integer
          format: int32
      - name: minPrice
        in: query
        required: false
        schema:
          type: integer
          format: int64
      - name: maxPrice
        in: query
        required: false
        schema:
          type: integer
          format: int64
      - name: minEngagement
        in: query
        required: false
        schema:
          type: number
          format: double
      - name: language
        in: query
        required: false
        schema:
          type: string
      responses:
        "200":
          description: Channel count
          content:
            '*/*':
              schema:
                type: integer
                format: int64
  /api/v1/categories:
    get:
      tags:
      - Reference Data
      summary: List all active categories
      operationId: listCategories
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/CategoryDto"
components:
  schemas:
    CanaryUpdate:
      type: object
      properties:
        percent:
          type: integer
          format: int32
        salt:
          type: string
    CanaryStatus:
      type: object
      properties:
        percent:
          type: integer
          format: int32
        salt:
          type: string
        timestamp:
          type: string
          format: date-time
    DealNotifications:
      type: object
      description: Deal notification settings
      properties:
        newOffers:
          type: boolean
        acceptReject:
          type: boolean
        deliveryStatus:
          type: boolean
    DisputeNotifications:
      type: object
      description: Dispute notification settings
      properties:
        opened:
          type: boolean
        resolved:
          type: boolean
    FinancialNotifications:
      type: object
      description: Financial notification settings
      properties:
        deposits:
          type: boolean
        payouts:
          type: boolean
        escrow:
          type: boolean
    NotificationSettings:
      type: object
      description: Notification settings
      properties:
        deals:
          $ref: "#/components/schemas/DealNotifications"
          description: Deal notifications
        financial:
          $ref: "#/components/schemas/FinancialNotifications"
          description: Financial notifications
        disputes:
          $ref: "#/components/schemas/DisputeNotifications"
          description: Dispute notifications
    UpdateSettingsRequest:
      type: object
      description: Update user settings request
      properties:
        displayCurrency:
          type: string
          description: Fiat display currency code
          example: RUB
          maxLength: 3
          minLength: 3
        notificationSettings:
          $ref: "#/components/schemas/NotificationSettings"
          description: Notification preferences
    UserProfile:
      type: object
      description: Full user profile
      properties:
        id:
          type: integer
          format: int64
          description: Telegram user ID
          example: 42
        username:
          type: string
          description: Telegram username
          example: johndoe
        displayName:
          type: string
          description: Display name
          example: John Doe
        languageCode:
          type: string
          description: IETF language tag
          example: en
        displayCurrency:
          type: string
          description: Fiat display currency
          example: USD
        notificationSettings:
          $ref: "#/components/schemas/NotificationSettings"
          description: Notification preferences
        onboardingCompleted:
          type: boolean
          description: Whether onboarding is completed
        interests:
          type: array
          description: Selected interest tags
          items:
            type: string
        createdAt:
          type: string
          format: date-time
          description: Registration timestamp
    OnboardingRequest:
      type: object
      description: User onboarding completion request
      properties:
        interests:
          type: array
          description: Selected interest tags
          example:
          - tech
          - gaming
          items:
            type: string
            maxLength: 100
            minLength: 0
          maxItems: 50
          minItems: 0
      required:
      - interests
    UpdateLanguageRequest:
      type: object
      description: Update user language request
      properties:
        languageCode:
          type: string
          description: IETF language tag
          example: ru
          maxLength: 5
          minLength: 0
      required:
      - languageCode
    ChannelUpdateRequest:
      type: object
      description: Channel update request
      properties:
        description:
          type: string
        categories:
          type: array
          items:
            type: string
        pricePerPostNano:
          type: integer
          format: int64
        language:
          type: string
          maxLength: 10
          minLength: 0
        isActive:
          type: boolean
    ChannelResponse:
      type: object
      description: Registered channel
      properties:
        id:
          type: integer
          format: int64
        title:
          type: string
        username:
          type: string
        description:
          type: string
        subscriberCount:
          type: integer
          format: int32
        categories:
          type: array
          items:
            type: string
        pricePerPostNano:
          type: integer
          format: int64
        isActive:
          type: boolean
        ownerId:
          type: integer
          format: int64
        createdAt:
          type: string
          format: date-time
    TeamUpdateRightsRequest:
      type: object
      description: Team rights update request
      properties:
        rights:
          type: array
          items:
            type: string
            enum:
            - MODERATE
            - PUBLISH
            - MANAGE_TEAM
            - VIEW_STATS
          uniqueItems: true
      required:
      - rights
    TeamMemberDto:
      type: object
      description: Channel team member
      properties:
        userId:
          type: integer
          format: int64
        username:
          type: string
        firstName:
          type: string
        role:
          type: string
          enum:
          - OWNER
          - MANAGER
        rights:
          type: array
          items:
            type: string
            enum:
            - MODERATE
            - PUBLISH
            - MANAGE_TEAM
            - VIEW_STATS
          uniqueItems: true
        invitedBy:
          type: integer
          format: int64
        createdAt:
          type: string
          format: date-time
    PricingRuleUpdateRequest:
      type: object
      description: Pricing rule update request
      properties:
        name:
          type: string
          maxLength: 100
          minLength: 0
        description:
          type: string
        postTypes:
          type: array
          items:
            type: string
            enum:
            - REPOST
            - NATIVE
            - STORY
            - INTEGRATION
            - REVIEW
            - MENTION
            - GIVEAWAY
            - PINNED
            - POLL
            - FORWARD
          uniqueItems: true
        priceNano:
          type: integer
          format: int64
        sortOrder:
          type: integer
          format: int32
        isActive:
          type: boolean
    PricingRuleDto:
      type: object
      description: Channel pricing rule
      properties:
        id:
          type: integer
          format: int64
        channelId:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        postTypes:
          type: array
          items:
            type: string
            enum:
            - REPOST
            - NATIVE
            - STORY
            - INTEGRATION
            - REVIEW
            - MENTION
            - GIVEAWAY
            - PINNED
            - POLL
            - FORWARD
          uniqueItems: true
        priceNano:
          type: integer
          format: int64
        isActive:
          type: boolean
        sortOrder:
          type: integer
          format: int32
    JsonNode: {}
    WorkerCallback:
      type: object
      properties:
        callbackType:
          type: string
        dealId:
          type: string
          format: uuid
        correlationId:
          type: string
          format: uuid
        payload:
          $ref: "#/components/schemas/JsonNode"
    WorkerCallbackResponse:
      type: object
      properties:
        eventId:
          type: string
          format: uuid
        correlationId:
          type: string
          format: uuid
        status:
          type: string
    ChannelRegistrationRequest:
      type: object
      description: Channel registration request
      properties:
        channelId:
          type: integer
          format: int64
          description: Telegram chat ID from verify step
        categories:
          type: array
          description: Category slugs
          example:
          - tech
          items:
            type: string
        pricePerPostNano:
          type: integer
          format: int64
          description: Price per post in nanoTON
    TeamInviteRequest:
      type: object
      description: Team invite request
      properties:
        userId:
          type: integer
          format: int64
        rights:
          type: array
          items:
            type: string
            enum:
            - MODERATE
            - PUBLISH
            - MANAGE_TEAM
            - VIEW_STATS
          uniqueItems: true
      required:
      - rights
    PricingRuleCreateRequest:
      type: object
      description: Pricing rule creation request
      properties:
        name:
          type: string
          maxLength: 100
          minLength: 0
        description:
          type: string
        postTypes:
          type: array
          items:
            type: string
            enum:
            - REPOST
            - NATIVE
            - STORY
            - INTEGRATION
            - REVIEW
            - MENTION
            - GIVEAWAY
            - PINNED
            - POLL
            - FORWARD
          minItems: 1
          uniqueItems: true
        priceNano:
          type: integer
          format: int64
        sortOrder:
          type: integer
          format: int32
      required:
      - name
      - postTypes
    ChannelVerifyRequest:
      type: object
      description: Channel verification request
      properties:
        channelUsername:
          type: string
          description: Public channel username without @
          example: mychannel
          maxLength: 255
          minLength: 0
      required:
      - channelUsername
    BotStatus:
      type: object
      description: Bot status in the channel
      properties:
        isAdmin:
          type: boolean
        canPostMessages:
          type: boolean
        canEditMessages:
          type: boolean
        missingPermissions:
          type: array
          items:
            type: string
    ChannelVerifyResponse:
      type: object
      description: Channel verification result
      properties:
        channelId:
          type: integer
          format: int64
        title:
          type: string
        username:
          type: string
        subscriberCount:
          type: integer
          format: int32
        botStatus:
          $ref: "#/components/schemas/BotStatus"
        userStatus:
          $ref: "#/components/schemas/UserStatus"
    UserStatus:
      type: object
      description: User status in the channel
      properties:
        isMember:
          type: boolean
        role:
          type: string
    LoginRequest:
      type: object
      description: Telegram Mini App login request
      properties:
        initData:
          type: string
          description: Raw Telegram initData query string
          example: query_id=AAH...&auth_date=1700000000&hash=abc
          maxLength: 4096
          minLength: 0
      required:
      - initData
    LoginResponse:
      type: object
      description: Successful login response with JWT and user info
      properties:
        accessToken:
          type: string
          description: JWT access token
          example: eyJhbGciOiJIUzI1NiJ9...
        expiresIn:
          type: integer
          format: int64
          description: Token lifetime in seconds
          example: 3600
        user:
          $ref: "#/components/schemas/UserSummary"
          description: Summary of the authenticated user
    UserSummary:
      type: object
      description: Compact user info returned with the token
      properties:
        id:
          type: integer
          format: int64
          description: Telegram user ID
          example: 42
        username:
          type: string
          description: Telegram username (without @)
          example: johndoe
        displayName:
          type: string
          description: Display name from first + last name
          example: John Doe
    PostTypeDto:
      type: object
      description: Post type with localized labels
      properties:
        value:
          type: string
          enum:
          - REPOST
          - NATIVE
          - STORY
          - INTEGRATION
          - REVIEW
          - MENTION
          - GIVEAWAY
          - PINNED
          - POLL
          - FORWARD
        localizedName:
          type: object
          additionalProperties:
            type: string
    ChannelListItem:
      type: object
      description: Channel search result item
      properties:
        id:
          type: integer
          format: int64
        title:
          type: string
        username:
          type: string
        categories:
          type: array
          items:
            type: string
        subscriberCount:
          type: integer
          format: int32
        avgViews:
          type: integer
          format: int32
        engagementRate:
          type: number
        pricePerPostNano:
          type: integer
          format: int64
        isActive:
          type: boolean
        updatedAt:
          type: string
          format: date-time
    CursorPageChannelListItem:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ChannelListItem"
        nextCursor:
          type: string
        hasNext:
          type: boolean
    ChannelDetailResponse:
      type: object
      description: Full channel detail with pricing rules
      properties:
        id:
          type: integer
          format: int64
        title:
          type: string
        username:
          type: string
        description:
          type: string
        subscriberCount:
          type: integer
          format: int32
        categories:
          type: array
          items:
            type: string
        pricePerPostNano:
          type: integer
          format: int64
        isActive:
          type: boolean
        ownerId:
          type: integer
          format: int64
        engagementRate:
          type: number
        avgViews:
          type: integer
          format: int32
        language:
          type: string
        pricingRules:
          type: array
          items:
            $ref: "#/components/schemas/PricingRuleDto"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    CategoryDto:
      type: object
      description: Channel category with localized names
      properties:
        id:
          type: integer
          format: int32
        slug:
          type: string
        localizedName:
          type: object
          additionalProperties:
            type: string
        sortOrder:
          type: integer
          format: int32
    DealStatus:
      type: string
      description: Deal lifecycle states
      enum:
      - DRAFT
      - OFFER_PENDING
      - NEGOTIATING
      - ACCEPTED
      - AWAITING_PAYMENT
      - FUNDED
      - CREATIVE_SUBMITTED
      - CREATIVE_APPROVED
      - SCHEDULED
      - PUBLISHED
      - DELIVERY_VERIFYING
      - COMPLETED_RELEASED
      - DISPUTED
      - CANCELLED
      - REFUNDED
      - PARTIALLY_REFUNDED
      - EXPIRED
    DealEventDto:
      type: object
      description: Deal event
      properties:
        id:
          type: integer
          format: int64
        eventType:
          type: string
        fromStatus:
          $ref: "#/components/schemas/DealStatus"
        toStatus:
          $ref: "#/components/schemas/DealStatus"
        actorId:
          type: integer
          format: int64
        createdAt:
          type: string
          format: date-time
    DealDto:
      type: object
      description: Deal summary
      properties:
        id:
          type: string
          format: uuid
        channelId:
          type: integer
          format: int64
        advertiserId:
          type: integer
          format: int64
        ownerId:
          type: integer
          format: int64
        status:
          $ref: "#/components/schemas/DealStatus"
        amountNano:
          type: integer
          format: int64
        deadlineAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        version:
          type: integer
          format: int32
    DealDetailDto:
      type: object
      description: Deal detail with event timeline
      properties:
        id:
          type: string
          format: uuid
        channelId:
          type: integer
          format: int64
        advertiserId:
          type: integer
          format: int64
        ownerId:
          type: integer
          format: int64
        status:
          $ref: "#/components/schemas/DealStatus"
        amountNano:
          type: integer
          format: int64
        commissionRateBp:
          type: integer
          format: int32
        commissionNano:
          type: integer
          format: int64
        deadlineAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        version:
          type: integer
          format: int32
        timeline:
          type: array
          items:
            $ref: "#/components/schemas/DealEventDto"
    CreateDealRequest:
      type: object
      description: REST request body for creating a deal
      properties:
        channelId:
          type: integer
          format: int64
        amountNano:
          type: integer
          format: int64
        pricingRuleId:
          type: integer
          format: int64
        creativeBrief:
          type: string
    DealTransitionRequest:
      type: object
      description: REST request body for transitioning a deal status
      properties:
        targetStatus:
          $ref: "#/components/schemas/DealStatus"
        reason:
          type: string
    DealTransitionResponse:
      type: object
      description: REST response for a deal transition result
      properties:
        status:
          type: string
        newStatus:
          $ref: "#/components/schemas/DealStatus"
        currentStatus:
          $ref: "#/components/schemas/DealStatus"
    CursorPageDealDto:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/DealDto"
        nextCursor:
          type: string
        hasNext:
          type: boolean
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
